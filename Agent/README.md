# Titan Node Agent

Titan Node åˆ†å¸ƒå¼è¾¹ç¼˜é‡‡é›† Agentï¼Œè´Ÿè´£åœ¨æµ‹è¯•å°æ¶ä¸Šé‡‡é›†æ—¥å¿—æ•°æ®å¹¶ä¸ŠæŠ¥è‡³ä¸­å¿ƒåç«¯ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
pip install "requests>=2.31.0" -i https://pypi.tuna.tsinghua.edu.cn/simple
```

### 2. å¯åŠ¨ Agent

```bash
cd Agent
python agent.py
```

## ğŸ“‹ é…ç½®è¯´æ˜

### é¦–æ¬¡å¯åŠ¨é…ç½®

Agent å¯åŠ¨åä¼šè¿›è¡Œäº¤äº’å¼é…ç½®ï¼š

```
=== åˆ†å¸ƒå¼å°æ¶ç›‘æ§ Agent å¯åŠ¨ ===
è¯·è¾“å…¥å°æ¶åç§° (ç›´æ¥å›è½¦é»˜è®¤: Rig-01): 
è¯·è¾“å…¥æ—¥å¿—è·¯å¾„ (ç›´æ¥å›è½¦é»˜è®¤: D:\SIP_SAMSUNG_8GB\TEMP): 

è¯·é€‰æ‹©å½“å‰ä»»åŠ¡ç±»å‹:
  1. å¾ªç¯å¯åŠ¨ä»»åŠ¡
  2. å›ºå®šæ—¶é•¿ä»»åŠ¡
è¯·è¾“å…¥ç¼–å· (1-2): 1

é…ç½®å®Œæˆ! 
å½“å‰å°æ¶: Rig-01
ç›‘æ§è·¯å¾„: D:\SIP_SAMSUNG_8GB\TEMP
ä»»åŠ¡ç±»å‹: å¾ªç¯å¯åŠ¨ä»»åŠ¡
æ­£åœ¨å¼€å§‹åˆ†æ...
```

### è¾“å…¥ Demo

```bash
# å°æ¶åç§°
Rig-01

# æ—¥å¿—è·¯å¾„ï¼ˆç›´æ¥å›è½¦ä½¿ç”¨é»˜è®¤è·¯å¾„ï¼‰
D:\SIP_SAMSUNG_8GB\TEMP

# ä»»åŠ¡ç±»å‹é€‰æ‹©
1
```

## âš™ï¸ é…ç½®æ–‡ä»¶

Agent ä¼šè‡ªåŠ¨åˆ›å»º `config.json` é…ç½®æ–‡ä»¶ï¼ˆé»˜è®¤è¢« Git å¿½ç•¥ï¼‰ï¼š

```json
{
    "BACKEND_URL": "https://titan-backend.080977.xyz/api/report",
    "SCAN_INTERVAL": 30
}
```

### é…ç½®é¡¹è¯´æ˜

- **BACKEND_URL**: åç«¯ API åœ°å€ï¼Œéœ€è¦æŒ‡å‘ä¸­å¿ƒæœåŠ¡å™¨
- **SCAN_INTERVAL**: æ‰«æé—´éš”ï¼ˆç§’ï¼‰ï¼Œé»˜è®¤ 30 ç§’

## ğŸ“ æ—¥å¿—æ–‡ä»¶è¦æ±‚

Agent ä¼šåœ¨æŒ‡å®šè·¯å¾„ä¸‹è‡ªåŠ¨æ‰«æå’Œé…å¯¹æ—¥å¿—æ–‡ä»¶ï¼š

### æ–‡ä»¶å‘½åè§„åˆ™

- **Kernel æ—¥å¿—**: `{board_id}.log`
- **CM55 æ—¥å¿—**: `{board_id}_cm55.log`

### ç¤ºä¾‹æ–‡ä»¶ç»“æ„

```
D:\SIP_SAMSUNG_8GB\TEMP\
â”œâ”€â”€ board001.log              # Kernel æ—¥å¿—
â”œâ”€â”€ board001_cm55.log         # CM55 æ¸©åº¦æ—¥å¿—
â”œâ”€â”€ board002.log              # Kernel æ—¥å¿—
â”œâ”€â”€ board002_cm55.log         # CM55 æ¸©åº¦æ—¥å¿—
â””â”€â”€ ...
```

## ğŸ”§ åŠŸèƒ½ç‰¹æ€§

### æ—¥å¿—è§£æèƒ½åŠ›

- **Kernel æ—¥å¿—è§£æ**:
  - å¼€å§‹æ—¶é—´æå–
  - ä»»åŠ¡è¿›åº¦è·Ÿè¸ª
  - å¾ªç¯æ¬¡æ•°ç»Ÿè®¡
  - é”™è¯¯å…³é”®å­—æ£€æµ‹
  - æŒ‚èµ·çŠ¶æ€æ£€æµ‹

- **CM55 æ—¥å¿—è§£æ**:
  - å…¨é‡æ¸©åº¦å†å²è®°å½•
  - SoC/DDR æ¸©åº¦ç›‘æ§
  - è¶…æ¸©è­¦å‘Šæ£€æµ‹
  - æ™ºèƒ½æ•°æ®æŠ½æ ·

### ä»»åŠ¡ç±»å‹æ”¯æŒ

1. **å¾ªç¯å¯åŠ¨ä»»åŠ¡**
   - åŸºäº `BMX7 DDR Reboot Test: Loop(\d+)` ç»Ÿè®¡å¾ªç¯æ¬¡æ•°
   - æ£€æµ‹å¼‚å¸¸é‡å¯è·¯å¾„
   - åŸºäº `Seconds remaining` è®¡ç®—æ—¶é—´è¿›åº¦

2. **å›ºå®šæ—¶é•¿ä»»åŠ¡**
   - åŸºäº `Seconds remaining` ç²¾ç¡®è®¡ç®—å‰©ä½™æ—¶é—´
   - 48å°æ—¶æ€»æ—¶é•¿ç›‘æ§
   - è‡ªåŠ¨å®ŒæˆçŠ¶æ€æ£€æµ‹

### åŠ¨æ€è§„åˆ™é…ç½®

Agent æ”¯æŒä»åç«¯åŠ¨æ€è·å–è§„åˆ™é…ç½®ï¼Œæ— éœ€é‡æ–°éƒ¨ç½²å³å¯æ›´æ–°æ£€æµ‹é€»è¾‘ï¼š

#### è§„åˆ™è·å–æœºåˆ¶
- **å¯åŠ¨æ—¶è·å–**ï¼šAgent å¯åŠ¨æ—¶ç«‹å³ä»åç«¯è·å–æœ€æ–°è§„åˆ™
- **å®šæœŸæ›´æ–°**ï¼šæ¯ 5 åˆ†é’Ÿè‡ªåŠ¨æ£€æŸ¥è§„åˆ™æ›´æ–°
- **å¤±è´¥åå¤‡**ï¼šç½‘ç»œå¼‚å¸¸æ—¶ä½¿ç”¨å†…ç½®é»˜è®¤è§„åˆ™
- **ç‰ˆæœ¬æ§åˆ¶**ï¼šæ”¯æŒè§„åˆ™ç‰ˆæœ¬ç®¡ç†å’Œå¢é‡æ›´æ–°

#### è§„åˆ™é…ç½®å†…å®¹
- **æ—¶é—´è®¡ç®—è§„åˆ™**ï¼šæ”¯æŒ reboot è„šæœ¬æ—¶é—´å’Œ remaining seconds ä¸¤ç§æ¨¡å¼
- **é”™è¯¯æ¨¡å¼æ£€æµ‹**ï¼šå¯é…ç½®ä»»æ„é”™è¯¯åŒ¹é…æ¨¡å¼
- **å¾ªç¯æ£€æµ‹è§„åˆ™**ï¼šå¯é…ç½®å¾ªç¯æ¬¡æ•°ç»Ÿè®¡æ¨¡å¼
- **ä¸¥é‡é”™è¯¯æ£€æµ‹**ï¼šå¯é…ç½®ä¸¥é‡é”™è¯¯å…³é”®è¯åˆ—è¡¨
- **æŒ‚èµ·æ£€æµ‹è§„åˆ™**ï¼šå¯é…ç½®æ£€æµ‹é˜ˆå€¼å’Œç›‘æ§èŒƒå›´

### å†å²é”™è¯¯æ£€æµ‹

Agent æ”¯æŒå†·å¯åŠ¨æ—¶å…¨é‡å†å²æ—¥å¿—æ‰«æï¼š

#### æ£€æµ‹èƒ½åŠ›
- **å…¨é‡é”™è¯¯æ‰«æ**ï¼šå¯åŠ¨æ—¶æ‰«æå®Œæ•´æ—¥å¿—å†å²
- **å¾ªç¯æ¬¡æ•°ç»Ÿè®¡**ï¼šåŸºäºå…¨é‡æ—¥å¿—è·å–æœ€å¤§å¾ªç¯æ¬¡æ•°
- **é”™è¯¯çŠ¶æ€ä¿æŠ¤**ï¼šå†å²é”™è¯¯çŠ¶æ€ä¸ä¼šè¢«å…¶ä»–é€»è¾‘è¦†ç›–
- **å®æ—¶+å†å²**ï¼šç»“åˆå†å²æ£€æµ‹å’Œå®æ—¶ç›‘æ§

#### æ£€æµ‹è¾“å‡º
```
[ğŸ” 090] å¼€å§‹å…¨é‡å†å²é”™è¯¯æ£€æµ‹...
[âŒ 090] å†å²æ—¥å¿—ä¸­å‘ç°é”™è¯¯: Hardware MISMATCH
[ğŸ”„ 090] æ£€æµ‹åˆ°å¾ªç¯: 5/12
```

### é”™è¯¯æ£€æµ‹

#### æ”¯æŒçš„é”™è¯¯ç±»å‹
- **Miscompare é”™è¯¯**ï¼š`Error: miscompare`ã€`Hardware Error: miscompare`ã€`Report Error: miscompare`
- **Mismatch é”™è¯¯**ï¼š`[Error] Mismatch`ã€`Error: MISMATCH`
- **é‡å¯é”™è¯¯**ï¼š`Switch to Full Training Boot`ã€`2D Training Successfullyï¼`
- **ä¸¥é‡é”™è¯¯**ï¼š`KERNEL PANIC`ã€`MACHINE CHECK`ã€`REBOOTING`ã€`OUT OF MEMORY`ã€`SEGMENTATION FAULT`
- **æŒ‚èµ·æ£€æµ‹**ï¼šè¶…è¿‡ 5 åˆ†é’Ÿæ— æ—¥å¿—æ›´æ–°ï¼ˆå¯é…ç½®é˜ˆå€¼ï¼‰
- **è¶…æ¸©è­¦å‘Š**ï¼š`W/NO_TAG THM_INFO: warning:check_temp exceed!!!`

#### çŠ¶æ€ä¼˜å…ˆçº§
`Error` > `Finished` > `Running` > `Warning`

é”™è¯¯çŠ¶æ€å…·æœ‰æœ€é«˜ä¼˜å…ˆçº§ï¼Œä¸ä¼šè¢«å…¶ä»–é€»è¾‘è¦†ç›–ã€‚

## ğŸ“Š æ•°æ®ä¸ŠæŠ¥

Agent ä¼šå®šæœŸå‘åç«¯ä¸ŠæŠ¥æ•°æ®ï¼ŒåŒ…å«ï¼š

- æ¿å­åŸºç¡€ä¿¡æ¯ï¼ˆIDã€çŠ¶æ€ã€ä»»åŠ¡ç±»å‹ï¼‰
- æ—¶é—´è¿›åº¦ï¼ˆå¼€å§‹æ—¶é—´ã€å·²ç”¨æ—¶é—´ã€å‰©ä½™æ—¶é—´ï¼‰
- æ¸©åº¦æ•°æ®ï¼ˆå½“å‰æ¸©åº¦ã€å†å²æå€¼ã€DDR è¯¦æƒ…ï¼‰
- é”™è¯¯ä¿¡æ¯ï¼ˆé”™è¯¯åˆ—è¡¨ã€æŒ‚èµ·çŠ¶æ€ï¼‰
- æ—¥å¿—æµï¼ˆæœ€å100è¡ŒKernelæ—¥å¿—ï¼‰

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ— æ³•è¿æ¥åç«¯**
   ```
   ä¸ŠæŠ¥å¤±è´¥: Connection refused
   ```
   æ£€æŸ¥ `config.json` ä¸­çš„ `BACKEND_URL` æ˜¯å¦æ­£ç¡®

2. **æ‰¾ä¸åˆ°æ—¥å¿—æ–‡ä»¶**
   ```
   è¯¥ç›®å½•ä¸‹æ²¡æœ‰å­æ–‡ä»¶å¤¹ï¼Œè¯·æ£€æŸ¥ç›®å½•ç»“æ„
   ```
   ç¡®è®¤æ—¥å¿—è·¯å¾„æ­£ç¡®ä¸”åŒ…å«å¯¹åº”çš„æ—¥å¿—æ–‡ä»¶

3. **æƒé™é—®é¢˜**
   ```
   Permission denied
   ```
   ç¡®ä¿å¯¹æ—¥å¿—ç›®å½•æœ‰è¯»å–æƒé™

### è°ƒè¯•æ¨¡å¼

Agent è¿è¡Œæ—¶ä¼šè¾“å‡ºè¯¦ç»†æ—¥å¿—ï¼š
```
[board001] kernel=True cm55=True | cm55_file=board001_cm55.log
[2024-02-23 18:30:45] ä¸ŠæŠ¥æ•°æ®: 2 ä¸ªæ¿å­å·²åœ¨çº¿ (ä»»åŠ¡: å¾ªç¯å¯åŠ¨ä»»åŠ¡)ã€‚
```

## ğŸ“ æ³¨æ„äº‹é¡¹

- Agent é…ç½®æ–‡ä»¶ `config.json` ä¼šè¢« Git å¿½ç•¥ï¼Œé€‚åˆæœ¬åœ°ç‹¬ç«‹ç»´æŠ¤
- å»ºè®®åœ¨æ¯ä¸ªæµ‹è¯•å°æ¶ä¸Šç‹¬ç«‹è¿è¡Œ Agent å®ä¾‹
- ç¡®ä¿ Agent ä¸åç«¯æœåŠ¡å™¨ç½‘ç»œè¿é€š
- æ—¥å¿—æ–‡ä»¶ç¼–ç å»ºè®®ä½¿ç”¨ UTF-8

## ğŸ”„ æŒç»­è¿è¡Œ

Agent ä¼šæŒç»­è¿è¡Œï¼Œå®šæœŸæ‰«ææ—¥å¿—å¹¶ä¸ŠæŠ¥æ•°æ®ï¼š

```bash
# ä½¿ç”¨ nohup åå°è¿è¡Œï¼ˆLinux/macOSï¼‰
nohup python agent.py > agent.log 2>&1 &

# ä½¿ç”¨ screen/tmux ä¿æŒä¼šè¯
screen -S titan-agent
python agent.py
# Ctrl+A+D åˆ†ç¦»ä¼šè¯
```
